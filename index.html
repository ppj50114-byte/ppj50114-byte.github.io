<!doctype html>
<html lang="zh-CN">
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>登录 - 团队空间</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gradient-to-br from-gray-900 via-purple-800 to-indigo-900 min-h-screen flex items-center justify-center text-white">
  <div class="bg-white bg-opacity-6 p-8 rounded-lg shadow-xl w-full max-w-md">
    <h1 class="text-2xl font-bold mb-4">云善绘 团队空间</h1>
    <input id="name" class="w-full p-2 rounded mb-3 text-black" placeholder="请输入您的姓名 (客户或 光明会)" />
    <input id="password" type="password" class="w-full p-2 rounded mb-3 text-black hidden" placeholder="管理员密码（光明会专用）" />
    <div class="flex space-x-2">
      <button id="loginBtn" class="px-4 py-2 bg-indigo-600 rounded">登录</button>
      <button id="clearBtn" class="px-4 py-2 bg-gray-700 rounded">清空</button>
    </div>
    <p id="err" class="text-red-300 mt-3"></p>
  </div>

<script>
const nameInput = document.getElementById('name');
const pwdInput = document.getElementById('password');
const err = document.getElementById('err');
nameInput.addEventListener('input', ()=>{
  if(nameInput.value.trim() === '光明会') pwdInput.classList.remove('hidden');
  else pwdInput.classList.add('hidden');
});
document.getElementById('clearBtn').addEventListener('click', ()=>{ nameInput.value=''; pwdInput.value=''; err.textContent=''; });
document.getElementById('loginBtn').addEventListener('click', async ()=>{
  const name = nameInput.value.trim();
  const password = pwdInput.classList.contains('hidden') ? null : pwdInput.value;
  if(!name){ err.textContent='请输入名字'; return; }
  const res = await fetch('/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name, password})});
  const j = await res.json();
  if(!j.success){ err.textContent = j.msg || '登录失败'; return; }
  // redirect
  if(j.role === 'admin') location.href = '/admin.html';
  else location.href = '/client.html?name=' + encodeURIComponent(j.name);
});
</script>
</body></html>